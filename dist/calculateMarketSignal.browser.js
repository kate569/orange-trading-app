"use strict";
// Browser-compatible version of calculateMarketSignal
// Uses embedded rules instead of filesystem access
Object.defineProperty(exports, "__esModule", { value: true });
exports.STRATEGY_WIN_RATES = void 0;
exports.calculateMarketSignalBrowser = calculateMarketSignalBrowser;
// Embedded market rules (from constants/market_rules.json)
const MARKET_RULES = {
    theme: "Orange Juice Trading",
    frost_rule: {
        critical_temp_f: 28,
        min_duration_hours: 4,
        target_counties: ["Polk", "Highlands", "Lake"],
    },
    inventory_multipliers: {
        under_35m: 2.0,
        "35_45m": 1.5,
        over_55m: 0.7,
    },
    win_rates: {
        la_nina_double_hit: 0.79,
        volatility_pre_frost: 0.79,
        real_frost: 0.76,
        hurricane_false_alarm: 0.71,
        brazil_drought: 0.69,
    },
};
// Additional market context multipliers
const LA_NINA_MULTIPLIER = 1.4;
const HURRICANE_FALSE_ALARM_WIN_RATE = 0.71;
const BRAZIL_DROUGHT_WIN_RATE = 0.69;
const BRAZIL_DROUGHT_THRESHOLD = -1.5;
const BRAZIL_DROUGHT_MONTHS = [8, 9, 10]; // Aug, Sep, Oct
const MAX_WIN_PROBABILITY = 0.95;
/**
 * Calculates market signal based on temperature, frost duration, inventory levels,
 * and market context (La Niña, Hurricane, Brazil Drought conditions).
 * Browser-compatible version with embedded rules.
 *
 * @param currentTemp - Current temperature in Fahrenheit
 * @param hoursBelow28 - Number of hours temperature has been below 28°F
 * @param currentInventory - Current inventory in millions (e.g., 30 for 30M)
 * @param marketContext - Optional market context parameters (La Niña, Hurricane, Brazil)
 * @returns MarketSignalResultWithInsight with win probability, recommended action, and insight
 */
function calculateMarketSignalBrowser(currentTemp, hoursBelow28, currentInventory, marketContext) {
    const { frost_rule, inventory_multipliers, win_rates } = MARKET_RULES;
    // Default market context
    const context = marketContext ?? {
        isLaNina: false,
        isHurricaneActive: false,
        hurricaneCenterFarFromPolk: false,
        brazilRainfallIndex: 0,
        currentMonth: new Date().getMonth() + 1,
    };
    // Check for Brazil Drought first (Aug-Oct, SPI-3 < -1.5)
    const isBrazilDroughtSeason = BRAZIL_DROUGHT_MONTHS.includes(context.currentMonth);
    const isBrazilDrought = isBrazilDroughtSeason &&
        context.brazilRainfallIndex < BRAZIL_DROUGHT_THRESHOLD;
    if (isBrazilDrought) {
        return {
            winProbability: BRAZIL_DROUGHT_WIN_RATE,
            recommendedAction: "STRONG LONG (Brazil Drought)",
            isHurricaneFalseAlarm: false,
            isLaNinaActive: context.isLaNina,
            isBrazilDrought: true,
            insight: {
                frostCondition: "Brazil drought override active - frost conditions bypassed",
                inventoryCondition: "Brazil drought override active - inventory conditions bypassed",
                multiplierApplied: 1.0,
                baseWinRate: BRAZIL_DROUGHT_WIN_RATE,
                brazilDroughtEffect: `Brazil SPI-3 at ${context.brazilRainfallIndex.toFixed(1)} (< ${BRAZIL_DROUGHT_THRESHOLD}) during peak season. Historical win rate: ${BRAZIL_DROUGHT_WIN_RATE * 100}%`,
            },
        };
    }
    // Check for Hurricane False Alarm - this overrides frost/inventory logic
    if (context.isHurricaneActive && context.hurricaneCenterFarFromPolk) {
        return {
            winProbability: HURRICANE_FALSE_ALARM_WIN_RATE,
            recommendedAction: "SELL/SHORT (False Alarm)",
            isHurricaneFalseAlarm: true,
            isLaNinaActive: context.isLaNina,
            isBrazilDrought: false,
            insight: {
                frostCondition: "Hurricane override active - frost conditions bypassed",
                inventoryCondition: "Hurricane override active - inventory conditions bypassed",
                multiplierApplied: 1.0,
                baseWinRate: HURRICANE_FALSE_ALARM_WIN_RATE,
                hurricaneEffect: `Hurricane center >100mi from Polk County = False Alarm. Historical win rate: ${HURRICANE_FALSE_ALARM_WIN_RATE * 100}%`,
            },
        };
    }
    // Determine base win probability based on frost conditions
    let baseWinProbability;
    let frostCondition;
    const isBelowCriticalTemp = currentTemp < frost_rule.critical_temp_f;
    const hasSufficientDuration = hoursBelow28 >= frost_rule.min_duration_hours;
    if (isBelowCriticalTemp && hasSufficientDuration) {
        // Real frost conditions met
        baseWinProbability = win_rates.real_frost;
        frostCondition = `Real frost detected: ${currentTemp}°F for ${hoursBelow28}+ hours`;
    }
    else if (isBelowCriticalTemp) {
        // Pre-frost volatility (below critical temp but not enough duration yet)
        baseWinProbability = win_rates.volatility_pre_frost;
        frostCondition = `Pre-frost volatility: ${currentTemp}°F (need ${frost_rule.min_duration_hours}h duration)`;
    }
    else {
        // No frost signal - use a baseline probability
        baseWinProbability = 0.5;
        frostCondition = `No frost signal: ${currentTemp}°F above ${frost_rule.critical_temp_f}°F threshold`;
    }
    // Determine inventory multiplier
    let inventoryMultiplier;
    let inventoryCondition;
    if (currentInventory < 35) {
        inventoryMultiplier = inventory_multipliers.under_35m;
        inventoryCondition = `Inventory < 35M triggers ${inventoryMultiplier}x risk multiplier`;
    }
    else if (currentInventory <= 45) {
        inventoryMultiplier = inventory_multipliers["35_45m"];
        inventoryCondition = `Inventory 35-45M triggers ${inventoryMultiplier}x multiplier`;
    }
    else if (currentInventory > 55) {
        inventoryMultiplier = inventory_multipliers.over_55m;
        inventoryCondition = `Inventory > 55M triggers ${inventoryMultiplier}x (reduced) multiplier`;
    }
    else {
        // Between 45 and 55, use neutral multiplier
        inventoryMultiplier = 1.0;
        inventoryCondition = `Inventory 45-55M: neutral position (1.0x multiplier)`;
    }
    // Calculate win probability with inventory multiplier
    let winProbability = baseWinProbability * inventoryMultiplier;
    // Apply La Niña effect
    let laNinaEffect;
    if (context.isLaNina) {
        winProbability *= LA_NINA_MULTIPLIER;
        laNinaEffect = `La Niña active (ONI < -0.5): ${LA_NINA_MULTIPLIER}x multiplier applied. Historical "Double Hit" win rate: ${win_rates.la_nina_double_hit * 100}%`;
    }
    // Cap at maximum probability
    winProbability = Math.min(winProbability, MAX_WIN_PROBABILITY);
    // Determine recommended action based on inventory and conditions
    let recommendedAction;
    if (currentInventory < 35) {
        recommendedAction = "Double Position";
    }
    else if (currentInventory <= 45 && isBelowCriticalTemp) {
        recommendedAction = "Increase Position";
    }
    else if (currentInventory > 55) {
        recommendedAction = "Reduce Position";
    }
    else if (isBelowCriticalTemp && hasSufficientDuration) {
        recommendedAction = "Hold Position";
    }
    else {
        recommendedAction = "Monitor";
    }
    // Hurricane warning without false alarm condition
    let hurricaneEffect;
    if (context.isHurricaneActive && !context.hurricaneCenterFarFromPolk) {
        hurricaneEffect = "Hurricane warning active - monitoring for potential impact on Polk County";
    }
    // Brazil drought info (outside of season or above threshold)
    let brazilDroughtEffect;
    if (isBrazilDroughtSeason && context.brazilRainfallIndex >= BRAZIL_DROUGHT_THRESHOLD) {
        brazilDroughtEffect = `Brazil SPI-3 at ${context.brazilRainfallIndex.toFixed(1)} (above ${BRAZIL_DROUGHT_THRESHOLD} threshold) - no drought signal`;
    }
    else if (!isBrazilDroughtSeason && context.brazilRainfallIndex < BRAZIL_DROUGHT_THRESHOLD) {
        brazilDroughtEffect = `Brazil SPI-3 at ${context.brazilRainfallIndex.toFixed(1)} - drought conditions noted but outside Aug-Oct window`;
    }
    return {
        winProbability: Math.round(winProbability * 100) / 100,
        recommendedAction,
        isHurricaneFalseAlarm: false,
        isLaNinaActive: context.isLaNina,
        isBrazilDrought: false,
        insight: {
            frostCondition,
            inventoryCondition,
            multiplierApplied: inventoryMultiplier,
            baseWinRate: baseWinProbability,
            laNinaEffect,
            hurricaneEffect,
            brazilDroughtEffect,
        },
    };
}
// Export win rates for the Strategy Summary Table
exports.STRATEGY_WIN_RATES = {
    laNina: MARKET_RULES.win_rates.la_nina_double_hit,
    volatility: MARKET_RULES.win_rates.volatility_pre_frost,
    realFrost: MARKET_RULES.win_rates.real_frost,
    hurricaneFalseAlarm: MARKET_RULES.win_rates.hurricane_false_alarm,
    brazilDrought: MARKET_RULES.win_rates.brazil_drought,
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsY3VsYXRlTWFya2V0U2lnbmFsLmJyb3dzZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvY2FsY3VsYXRlTWFya2V0U2lnbmFsLmJyb3dzZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLHNEQUFzRDtBQUN0RCxtREFBbUQ7OztBQW9HbkQsb0VBOEpDO0FBOU1ELDJEQUEyRDtBQUMzRCxNQUFNLFlBQVksR0FBZ0I7SUFDaEMsS0FBSyxFQUFFLHNCQUFzQjtJQUM3QixVQUFVLEVBQUU7UUFDVixlQUFlLEVBQUUsRUFBRTtRQUNuQixrQkFBa0IsRUFBRSxDQUFDO1FBQ3JCLGVBQWUsRUFBRSxDQUFDLE1BQU0sRUFBRSxXQUFXLEVBQUUsTUFBTSxDQUFDO0tBQy9DO0lBQ0QscUJBQXFCLEVBQUU7UUFDckIsU0FBUyxFQUFFLEdBQUc7UUFDZCxRQUFRLEVBQUUsR0FBRztRQUNiLFFBQVEsRUFBRSxHQUFHO0tBQ2Q7SUFDRCxTQUFTLEVBQUU7UUFDVCxrQkFBa0IsRUFBRSxJQUFJO1FBQ3hCLG9CQUFvQixFQUFFLElBQUk7UUFDMUIsVUFBVSxFQUFFLElBQUk7UUFDaEIscUJBQXFCLEVBQUUsSUFBSTtRQUMzQixjQUFjLEVBQUUsSUFBSTtLQUNyQjtDQUNGLENBQUM7QUFFRix3Q0FBd0M7QUFDeEMsTUFBTSxrQkFBa0IsR0FBRyxHQUFHLENBQUM7QUFDL0IsTUFBTSw4QkFBOEIsR0FBRyxJQUFJLENBQUM7QUFDNUMsTUFBTSx1QkFBdUIsR0FBRyxJQUFJLENBQUM7QUFDckMsTUFBTSx3QkFBd0IsR0FBRyxDQUFDLEdBQUcsQ0FBQztBQUN0QyxNQUFNLHFCQUFxQixHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLGdCQUFnQjtBQUMxRCxNQUFNLG1CQUFtQixHQUFHLElBQUksQ0FBQztBQVNqQzs7Ozs7Ozs7OztHQVVHO0FBQ0gsU0FBZ0IsNEJBQTRCLENBQzFDLFdBQW1CLEVBQ25C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RCxPQUFPO1FBQ0wsY0FBYyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsY0FBYyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUc7UUFDdEQsaUJBQWlCO1FBQ2pCLHFCQUFxQixFQUFFLEtBQUs7UUFDNUIsY0FBYyxFQUFFLE9BQU8sQ0FBQyxRQUFRO1FBQ2hDLGVBQWUsRUFBRSxLQUFLO1FBQ3RCLE9BQU8sRUFBRTtZQUNQLGNBQWM7WUFDZCxrQkFBa0I7WUFDbEIsaUJBQWlCLEVBQUUsbUJBQW1CO1lBQ3RDLFdBQVcsRUFBRSxrQkFBa0I7WUFDL0IsWUFBWTtZQUNaLGVBQWU7WUFDZixtQkFBbUI7U0FDcEI7S0FDRixDQUFDO0FBQ0osQ0FBQztBQUVELGtEQUFrRDtBQUNyQyxRQUFBLGtCQUFrQixHQUFHO0lBQ2hDLE1BQU0sRUFBRSxZQUFZLENBQUMsU0FBUyxDQUFDLGtCQUFrQjtJQUNqRCxVQUFVLEVBQUUsWUFBWSxDQUFDLFNBQVMsQ0FBQyxvQkFBb0I7SUFDdkQsU0FBUyxFQUFFLFlBQVksQ0FBQyxTQUFTLENBQUMsVUFBVTtJQUM1QyxtQkFBbUIsRUFBRSxZQUFZLENBQUMsU0FBUyxDQUFDLHFCQUFxQjtJQUNqRSxhQUFhLEVBQUUsWUFBWSxDQUFDLFNBQVMsQ0FBQyxjQUFjO0NBQ3JELENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBCcm93c2VyLWNvbXBhdGlibGUgdmVyc2lvbiBvZiBjYWxjdWxhdGVNYXJrZXRTaWduYWxcbi8vIFVzZXMgZW1iZWRkZWQgcnVsZXMgaW5zdGVhZCBvZiBmaWxlc3lzdGVtIGFjY2Vzc1xuXG5pbnRlcmZhY2UgRnJvc3RSdWxlIHtcbiAgY3JpdGljYWxfdGVtcF9mOiBudW1iZXI7XG4gIG1pbl9kdXJhdGlvbl9ob3VyczogbnVtYmVyO1xuICB0YXJnZXRfY291bnRpZXM6IHN0cmluZ1tdO1xufVxuXG5pbnRlcmZhY2UgSW52ZW50b3J5TXVsdGlwbGllcnMge1xuICB1bmRlcl8zNW06IG51bWJlcjtcbiAgXCIzNV80NW1cIjogbnVtYmVyO1xuICBvdmVyXzU1bTogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgV2luUmF0ZXMge1xuICBsYV9uaW5hX2RvdWJsZV9oaXQ6IG51bWJlcjtcbiAgdm9sYXRpbGl0eV9wcmVfZnJvc3Q6IG51bWJlcjtcbiAgcmVhbF9mcm9zdDogbnVtYmVyO1xuICBodXJyaWNhbmVfZmFsc2VfYWxhcm06IG51bWJlcjtcbiAgYnJhemlsX2Ryb3VnaHQ6IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIE1hcmtldFJ1bGVzIHtcbiAgdGhlbWU6IHN0cmluZztcbiAgZnJvc3RfcnVsZTogRnJvc3RSdWxlO1xuICBpbnZlbnRvcnlfbXVsdGlwbGllcnM6IEludmVudG9yeU11bHRpcGxpZXJzO1xuICB3aW5fcmF0ZXM6IFdpblJhdGVzO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1hcmtldFNpZ25hbFJlc3VsdCB7XG4gIHdpblByb2JhYmlsaXR5OiBudW1iZXI7XG4gIHJlY29tbWVuZGVkQWN0aW9uOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2lnbmFsSW5zaWdodCB7XG4gIGZyb3N0Q29uZGl0aW9uOiBzdHJpbmc7XG4gIGludmVudG9yeUNvbmRpdGlvbjogc3RyaW5nO1xuICBtdWx0aXBsaWVyQXBwbGllZDogbnVtYmVyO1xuICBiYXNlV2luUmF0ZTogbnVtYmVyO1xuICBsYU5pbmFFZmZlY3Q/OiBzdHJpbmc7XG4gIGh1cnJpY2FuZUVmZmVjdD86IHN0cmluZztcbiAgYnJhemlsRHJvdWdodEVmZmVjdD86IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNYXJrZXRDb250ZXh0UGFyYW1zIHtcbiAgaXNMYU5pbmE6IGJvb2xlYW47XG4gIGlzSHVycmljYW5lQWN0aXZlOiBib29sZWFuO1xuICBodXJyaWNhbmVDZW50ZXJGYXJGcm9tUG9sazogYm9vbGVhbjtcbiAgYnJhemlsUmFpbmZhbGxJbmRleDogbnVtYmVyO1xuICBjdXJyZW50TW9udGg6IG51bWJlcjsgLy8gMS0xMlxufVxuXG4vLyBFbWJlZGRlZCBtYXJrZXQgcnVsZXMgKGZyb20gY29uc3RhbnRzL21hcmtldF9ydWxlcy5qc29uKVxuY29uc3QgTUFSS0VUX1JVTEVTOiBNYXJrZXRSdWxlcyA9IHtcbiAgdGhlbWU6IFwiT3JhbmdlIEp1aWNlIFRyYWRpbmdcIixcbiAgZnJvc3RfcnVsZToge1xuICAgIGNyaXRpY2FsX3RlbXBfZjogMjgsXG4gICAgbWluX2R1cmF0aW9uX2hvdXJzOiA0LFxuICAgIHRhcmdldF9jb3VudGllczogW1wiUG9sa1wiLCBcIkhpZ2hsYW5kc1wiLCBcIkxha2VcIl0sXG4gIH0sXG4gIGludmVudG9yeV9tdWx0aXBsaWVyczoge1xuICAgIHVuZGVyXzM1bTogMi4wLFxuICAgIFwiMzVfNDVtXCI6IDEuNSxcbiAgICBvdmVyXzU1bTogMC43LFxuICB9LFxuICB3aW5fcmF0ZXM6IHtcbiAgICBsYV9uaW5hX2RvdWJsZV9oaXQ6IDAuNzksXG4gICAgdm9sYXRpbGl0eV9wcmVfZnJvc3Q6IDAuNzksXG4gICAgcmVhbF9mcm9zdDogMC43NixcbiAgICBodXJyaWNhbmVfZmFsc2VfYWxhcm06IDAuNzEsXG4gICAgYnJhemlsX2Ryb3VnaHQ6IDAuNjksXG4gIH0sXG59O1xuXG4vLyBBZGRpdGlvbmFsIG1hcmtldCBjb250ZXh0IG11bHRpcGxpZXJzXG5jb25zdCBMQV9OSU5BX01VTFRJUExJRVIgPSAxLjQ7XG5jb25zdCBIVVJSSUNBTkVfRkFMU0VfQUxBUk1fV0lOX1JBVEUgPSAwLjcxO1xuY29uc3QgQlJBWklMX0RST1VHSFRfV0lOX1JBVEUgPSAwLjY5O1xuY29uc3QgQlJBWklMX0RST1VHSFRfVEhSRVNIT0xEID0gLTEuNTtcbmNvbnN0IEJSQVpJTF9EUk9VR0hUX01PTlRIUyA9IFs4LCA5LCAxMF07IC8vIEF1ZywgU2VwLCBPY3RcbmNvbnN0IE1BWF9XSU5fUFJPQkFCSUxJVFkgPSAwLjk1O1xuXG5leHBvcnQgaW50ZXJmYWNlIE1hcmtldFNpZ25hbFJlc3VsdFdpdGhJbnNpZ2h0IGV4dGVuZHMgTWFya2V0U2lnbmFsUmVzdWx0IHtcbiAgaW5zaWdodDogU2lnbmFsSW5zaWdodDtcbiAgaXNIdXJyaWNhbmVGYWxzZUFsYXJtOiBib29sZWFuO1xuICBpc0xhTmluYUFjdGl2ZTogYm9vbGVhbjtcbiAgaXNCcmF6aWxEcm91Z2h0OiBib29sZWFuO1xufVxuXG4vKipcbiAqIENhbGN1bGF0ZXMgbWFya2V0IHNpZ25hbCBiYXNlZCBvbiB0ZW1wZXJhdHVyZSwgZnJvc3QgZHVyYXRpb24sIGludmVudG9yeSBsZXZlbHMsXG4gKiBhbmQgbWFya2V0IGNvbnRleHQgKExhIE5pw7FhLCBIdXJyaWNhbmUsIEJyYXppbCBEcm91Z2h0IGNvbmRpdGlvbnMpLlxuICogQnJvd3Nlci1jb21wYXRpYmxlIHZlcnNpb24gd2l0aCBlbWJlZGRlZCBydWxlcy5cbiAqXG4gKiBAcGFyYW0gY3VycmVudFRlbXAgLSBDdXJyZW50IHRlbXBlcmF0dXJlIGluIEZhaHJlbmhlaXRcbiAqIEBwYXJhbSBob3Vyc0JlbG93MjggLSBOdW1iZXIgb2YgaG91cnMgdGVtcGVyYXR1cmUgaGFzIGJlZW4gYmVsb3cgMjjCsEZcbiAqIEBwYXJhbSBjdXJyZW50SW52ZW50b3J5IC0gQ3VycmVudCBpbnZlbnRvcnkgaW4gbWlsbGlvbnMgKGUuZy4sIDMwIGZvciAzME0pXG4gKiBAcGFyYW0gbWFya2V0Q29udGV4dCAtIE9wdGlvbmFsIG1hcmtldCBjb250ZXh0IHBhcmFtZXRlcnMgKExhIE5pw7FhLCBIdXJyaWNhbmUsIEJyYXppbClcbiAqIEByZXR1cm5zIE1hcmtldFNpZ25hbFJlc3VsdFdpdGhJbnNpZ2h0IHdpdGggd2luIHByb2JhYmlsaXR5LCByZWNvbW1lbmRlZCBhY3Rpb24sIGFuZCBpbnNpZ2h0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVNYXJrZXRTaWduYWxCcm93c2VyKFxuICBjdXJyZW50VGVtcDogbnVtYmVyLFxuICBob3Vyc0JlbG93Mjg6IG51bWJlcixcbiAgY3VycmVudEludmVudG9yeTogbnVtYmVyLFxuICBtYXJrZXRDb250ZXh0PzogTWFya2V0Q29udGV4dFBhcmFtc1xuKTogTWFya2V0U2lnbmFsUmVzdWx0V2l0aEluc2lnaHQge1xuICBjb25zdCB7IGZyb3N0X3J1bGUsIGludmVudG9yeV9tdWx0aXBsaWVycywgd2luX3JhdGVzIH0gPSBNQVJLRVRfUlVMRVM7XG5cbiAgLy8gRGVmYXVsdCBtYXJrZXQgY29udGV4dFxuICBjb25zdCBjb250ZXh0OiBNYXJrZXRDb250ZXh0UGFyYW1zID0gbWFya2V0Q29udGV4dCA/PyB7XG4gICAgaXNMYU5pbmE6IGZhbHNlLFxuICAgIGlzSHVycmljYW5lQWN0aXZlOiBmYWxzZSxcbiAgICBodXJyaWNhbmVDZW50ZXJGYXJGcm9tUG9sazogZmFsc2UsXG4gICAgYnJhemlsUmFpbmZhbGxJbmRleDogMCxcbiAgICBjdXJyZW50TW9udGg6IG5ldyBEYXRlKCkuZ2V0TW9udGgoKSArIDEsXG4gIH07XG5cbiAgLy8gQ2hlY2sgZm9yIEJyYXppbCBEcm91Z2h0IGZpcnN0IChBdWctT2N0LCBTUEktMyA8IC0xLjUpXG4gIGNvbnN0IGlzQnJhemlsRHJvdWdodFNlYXNvbiA9IEJSQVpJTF9EUk9VR0hUX01PTlRIUy5pbmNsdWRlcyhcbiAgICBjb250ZXh0LmN1cnJlbnRNb250aFxuICApO1xuICBjb25zdCBpc0JyYXppbERyb3VnaHQgPVxuICAgIGlzQnJhemlsRHJvdWdodFNlYXNvbiAmJlxuICAgIGNvbnRleHQuYnJhemlsUmFpbmZhbGxJbmRleCA8IEJSQVpJTF9EUk9VR0hUX1RIUkVTSE9MRDtcblxuICBpZiAoaXNCcmF6aWxEcm91Z2h0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHdpblByb2JhYmlsaXR5OiBCUkFaSUxfRFJPVUdIVF9XSU5fUkFURSxcbiAgICAgIHJlY29tbWVuZGVkQWN0aW9uOiBcIlNUUk9ORyBMT05HIChCcmF6aWwgRHJvdWdodClcIixcbiAgICAgIGlzSHVycmljYW5lRmFsc2VBbGFybTogZmFsc2UsXG4gICAgICBpc0xhTmluYUFjdGl2ZTogY29udGV4dC5pc0xhTmluYSxcbiAgICAgIGlzQnJhemlsRHJvdWdodDogdHJ1ZSxcbiAgICAgIGluc2lnaHQ6IHtcbiAgICAgICAgZnJvc3RDb25kaXRpb246IFwiQnJhemlsIGRyb3VnaHQgb3ZlcnJpZGUgYWN0aXZlIC0gZnJvc3QgY29uZGl0aW9ucyBieXBhc3NlZFwiLFxuICAgICAgICBpbnZlbnRvcnlDb25kaXRpb246IFwiQnJhemlsIGRyb3VnaHQgb3ZlcnJpZGUgYWN0aXZlIC0gaW52ZW50b3J5IGNvbmRpdGlvbnMgYnlwYXNzZWRcIixcbiAgICAgICAgbXVsdGlwbGllckFwcGxpZWQ6IDEuMCxcbiAgICAgICAgYmFzZVdpblJhdGU6IEJSQVpJTF9EUk9VR0hUX1dJTl9SQVRFLFxuICAgICAgICBicmF6aWxEcm91Z2h0RWZmZWN0OiBgQnJhemlsIFNQSS0zIGF0ICR7Y29udGV4dC5icmF6aWxSYWluZmFsbEluZGV4LnRvRml4ZWQoMSl9ICg8ICR7QlJBWklMX0RST1VHSFRfVEhSRVNIT0xEfSkgZHVyaW5nIHBlYWsgc2Vhc29uLiBIaXN0b3JpY2FsIHdpbiByYXRlOiAke0JSQVpJTF9EUk9VR0hUX1dJTl9SQVRFICogMTAwfSVgLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgLy8gQ2hlY2sgZm9yIEh1cnJpY2FuZSBGYWxzZSBBbGFybSAtIHRoaXMgb3ZlcnJpZGVzIGZyb3N0L2ludmVudG9yeSBsb2dpY1xuICBpZiAoY29udGV4dC5pc0h1cnJpY2FuZUFjdGl2ZSAmJiBjb250ZXh0Lmh1cnJpY2FuZUNlbnRlckZhckZyb21Qb2xrKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHdpblByb2JhYmlsaXR5OiBIVVJSSUNBTkVfRkFMU0VfQUxBUk1fV0lOX1JBVEUsXG4gICAgICByZWNvbW1lbmRlZEFjdGlvbjogXCJTRUxML1NIT1JUIChGYWxzZSBBbGFybSlcIixcbiAgICAgIGlzSHVycmljYW5lRmFsc2VBbGFybTogdHJ1ZSxcbiAgICAgIGlzTGFOaW5hQWN0aXZlOiBjb250ZXh0LmlzTGFOaW5hLFxuICAgICAgaXNCcmF6aWxEcm91Z2h0OiBmYWxzZSxcbiAgICAgIGluc2lnaHQ6IHtcbiAgICAgICAgZnJvc3RDb25kaXRpb246IFwiSHVycmljYW5lIG92ZXJyaWRlIGFjdGl2ZSAtIGZyb3N0IGNvbmRpdGlvbnMgYnlwYXNzZWRcIixcbiAgICAgICAgaW52ZW50b3J5Q29uZGl0aW9uOiBcIkh1cnJpY2FuZSBvdmVycmlkZSBhY3RpdmUgLSBpbnZlbnRvcnkgY29uZGl0aW9ucyBieXBhc3NlZFwiLFxuICAgICAgICBtdWx0aXBsaWVyQXBwbGllZDogMS4wLFxuICAgICAgICBiYXNlV2luUmF0ZTogSFVSUklDQU5FX0ZBTFNFX0FMQVJNX1dJTl9SQVRFLFxuICAgICAgICBodXJyaWNhbmVFZmZlY3Q6IGBIdXJyaWNhbmUgY2VudGVyID4xMDBtaSBmcm9tIFBvbGsgQ291bnR5ID0gRmFsc2UgQWxhcm0uIEhpc3RvcmljYWwgd2luIHJhdGU6ICR7SFVSUklDQU5FX0ZBTFNFX0FMQVJNX1dJTl9SQVRFICogMTAwfSVgLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgLy8gRGV0ZXJtaW5lIGJhc2Ugd2luIHByb2JhYmlsaXR5IGJhc2VkIG9uIGZyb3N0IGNvbmRpdGlvbnNcbiAgbGV0IGJhc2VXaW5Qcm9iYWJpbGl0eTogbnVtYmVyO1xuICBsZXQgZnJvc3RDb25kaXRpb246IHN0cmluZztcblxuICBjb25zdCBpc0JlbG93Q3JpdGljYWxUZW1wID0gY3VycmVudFRlbXAgPCBmcm9zdF9ydWxlLmNyaXRpY2FsX3RlbXBfZjtcbiAgY29uc3QgaGFzU3VmZmljaWVudER1cmF0aW9uID0gaG91cnNCZWxvdzI4ID49IGZyb3N0X3J1bGUubWluX2R1cmF0aW9uX2hvdXJzO1xuXG4gIGlmIChpc0JlbG93Q3JpdGljYWxUZW1wICYmIGhhc1N1ZmZpY2llbnREdXJhdGlvbikge1xuICAgIC8vIFJlYWwgZnJvc3QgY29uZGl0aW9ucyBtZXRcbiAgICBiYXNlV2luUHJvYmFiaWxpdHkgPSB3aW5fcmF0ZXMucmVhbF9mcm9zdDtcbiAgICBmcm9zdENvbmRpdGlvbiA9IGBSZWFsIGZyb3N0IGRldGVjdGVkOiAke2N1cnJlbnRUZW1wfcKwRiBmb3IgJHtob3Vyc0JlbG93Mjh9KyBob3Vyc2A7XG4gIH0gZWxzZSBpZiAoaXNCZWxvd0NyaXRpY2FsVGVtcCkge1xuICAgIC8vIFByZS1mcm9zdCB2b2xhdGlsaXR5IChiZWxvdyBjcml0aWNhbCB0ZW1wIGJ1dCBub3QgZW5vdWdoIGR1cmF0aW9uIHlldClcbiAgICBiYXNlV2luUHJvYmFiaWxpdHkgPSB3aW5fcmF0ZXMudm9sYXRpbGl0eV9wcmVfZnJvc3Q7XG4gICAgZnJvc3RDb25kaXRpb24gPSBgUHJlLWZyb3N0IHZvbGF0aWxpdHk6ICR7Y3VycmVudFRlbXB9wrBGIChuZWVkICR7ZnJvc3RfcnVsZS5taW5fZHVyYXRpb25faG91cnN9aCBkdXJhdGlvbilgO1xuICB9IGVsc2Uge1xuICAgIC8vIE5vIGZyb3N0IHNpZ25hbCAtIHVzZSBhIGJhc2VsaW5lIHByb2JhYmlsaXR5XG4gICAgYmFzZVdpblByb2JhYmlsaXR5ID0gMC41O1xuICAgIGZyb3N0Q29uZGl0aW9uID0gYE5vIGZyb3N0IHNpZ25hbDogJHtjdXJyZW50VGVtcH3CsEYgYWJvdmUgJHtmcm9zdF9ydWxlLmNyaXRpY2FsX3RlbXBfZn3CsEYgdGhyZXNob2xkYDtcbiAgfVxuXG4gIC8vIERldGVybWluZSBpbnZlbnRvcnkgbXVsdGlwbGllclxuICBsZXQgaW52ZW50b3J5TXVsdGlwbGllcjogbnVtYmVyO1xuICBsZXQgaW52ZW50b3J5Q29uZGl0aW9uOiBzdHJpbmc7XG5cbiAgaWYgKGN1cnJlbnRJbnZlbnRvcnkgPCAzNSkge1xuICAgIGludmVudG9yeU11bHRpcGxpZXIgPSBpbnZlbnRvcnlfbXVsdGlwbGllcnMudW5kZXJfMzVtO1xuICAgIGludmVudG9yeUNvbmRpdGlvbiA9IGBJbnZlbnRvcnkgPCAzNU0gdHJpZ2dlcnMgJHtpbnZlbnRvcnlNdWx0aXBsaWVyfXggcmlzayBtdWx0aXBsaWVyYDtcbiAgfSBlbHNlIGlmIChjdXJyZW50SW52ZW50b3J5IDw9IDQ1KSB7XG4gICAgaW52ZW50b3J5TXVsdGlwbGllciA9IGludmVudG9yeV9tdWx0aXBsaWVyc1tcIjM1XzQ1bVwiXTtcbiAgICBpbnZlbnRvcnlDb25kaXRpb24gPSBgSW52ZW50b3J5IDM1LTQ1TSB0cmlnZ2VycyAke2ludmVudG9yeU11bHRpcGxpZXJ9eCBtdWx0aXBsaWVyYDtcbiAgfSBlbHNlIGlmIChjdXJyZW50SW52ZW50b3J5ID4gNTUpIHtcbiAgICBpbnZlbnRvcnlNdWx0aXBsaWVyID0gaW52ZW50b3J5X211bHRpcGxpZXJzLm92ZXJfNTVtO1xuICAgIGludmVudG9yeUNvbmRpdGlvbiA9IGBJbnZlbnRvcnkgPiA1NU0gdHJpZ2dlcnMgJHtpbnZlbnRvcnlNdWx0aXBsaWVyfXggKHJlZHVjZWQpIG11bHRpcGxpZXJgO1xuICB9IGVsc2Uge1xuICAgIC8vIEJldHdlZW4gNDUgYW5kIDU1LCB1c2UgbmV1dHJhbCBtdWx0aXBsaWVyXG4gICAgaW52ZW50b3J5TXVsdGlwbGllciA9IDEuMDtcbiAgICBpbnZlbnRvcnlDb25kaXRpb24gPSBgSW52ZW50b3J5IDQ1LTU1TTogbmV1dHJhbCBwb3NpdGlvbiAoMS4weCBtdWx0aXBsaWVyKWA7XG4gIH1cblxuICAvLyBDYWxjdWxhdGUgd2luIHByb2JhYmlsaXR5IHdpdGggaW52ZW50b3J5IG11bHRpcGxpZXJcbiAgbGV0IHdpblByb2JhYmlsaXR5ID0gYmFzZVdpblByb2JhYmlsaXR5ICogaW52ZW50b3J5TXVsdGlwbGllcjtcblxuICAvLyBBcHBseSBMYSBOacOxYSBlZmZlY3RcbiAgbGV0IGxhTmluYUVmZmVjdDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICBpZiAoY29udGV4dC5pc0xhTmluYSkge1xuICAgIHdpblByb2JhYmlsaXR5ICo9IExBX05JTkFfTVVMVElQTElFUjtcbiAgICBsYU5pbmFFZmZlY3QgPSBgTGEgTmnDsWEgYWN0aXZlIChPTkkgPCAtMC41KTogJHtMQV9OSU5BX01VTFRJUExJRVJ9eCBtdWx0aXBsaWVyIGFwcGxpZWQuIEhpc3RvcmljYWwgXCJEb3VibGUgSGl0XCIgd2luIHJhdGU6ICR7d2luX3JhdGVzLmxhX25pbmFfZG91YmxlX2hpdCAqIDEwMH0lYDtcbiAgfVxuXG4gIC8vIENhcCBhdCBtYXhpbXVtIHByb2JhYmlsaXR5XG4gIHdpblByb2JhYmlsaXR5ID0gTWF0aC5taW4od2luUHJvYmFiaWxpdHksIE1BWF9XSU5fUFJPQkFCSUxJVFkpO1xuXG4gIC8vIERldGVybWluZSByZWNvbW1lbmRlZCBhY3Rpb24gYmFzZWQgb24gaW52ZW50b3J5IGFuZCBjb25kaXRpb25zXG4gIGxldCByZWNvbW1lbmRlZEFjdGlvbjogc3RyaW5nO1xuXG4gIGlmIChjdXJyZW50SW52ZW50b3J5IDwgMzUpIHtcbiAgICByZWNvbW1lbmRlZEFjdGlvbiA9IFwiRG91YmxlIFBvc2l0aW9uXCI7XG4gIH0gZWxzZSBpZiAoY3VycmVudEludmVudG9yeSA8PSA0NSAmJiBpc0JlbG93Q3JpdGljYWxUZW1wKSB7XG4gICAgcmVjb21tZW5kZWRBY3Rpb24gPSBcIkluY3JlYXNlIFBvc2l0aW9uXCI7XG4gIH0gZWxzZSBpZiAoY3VycmVudEludmVudG9yeSA+IDU1KSB7XG4gICAgcmVjb21tZW5kZWRBY3Rpb24gPSBcIlJlZHVjZSBQb3NpdGlvblwiO1xuICB9IGVsc2UgaWYgKGlzQmVsb3dDcml0aWNhbFRlbXAgJiYgaGFzU3VmZmljaWVudER1cmF0aW9uKSB7XG4gICAgcmVjb21tZW5kZWRBY3Rpb24gPSBcIkhvbGQgUG9zaXRpb25cIjtcbiAgfSBlbHNlIHtcbiAgICByZWNvbW1lbmRlZEFjdGlvbiA9IFwiTW9uaXRvclwiO1xuICB9XG5cbiAgLy8gSHVycmljYW5lIHdhcm5pbmcgd2l0aG91dCBmYWxzZSBhbGFybSBjb25kaXRpb25cbiAgbGV0IGh1cnJpY2FuZUVmZmVjdDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICBpZiAoY29udGV4dC5pc0h1cnJpY2FuZUFjdGl2ZSAmJiAhY29udGV4dC5odXJyaWNhbmVDZW50ZXJGYXJGcm9tUG9saykge1xuICAgIGh1cnJpY2FuZUVmZmVjdCA9IFwiSHVycmljYW5lIHdhcm5pbmcgYWN0aXZlIC0gbW9uaXRvcmluZyBmb3IgcG90ZW50aWFsIGltcGFjdCBvbiBQb2xrIENvdW50eVwiO1xuICB9XG5cbiAgLy8gQnJhemlsIGRyb3VnaHQgaW5mbyAob3V0c2lkZSBvZiBzZWFzb24gb3IgYWJvdmUgdGhyZXNob2xkKVxuICBsZXQgYnJhemlsRHJvdWdodEVmZmVjdDogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICBpZiAoaXNCcmF6aWxEcm91Z2h0U2Vhc29uICYmIGNvbnRleHQuYnJhemlsUmFpbmZhbGxJbmRleCA+PSBCUkFaSUxfRFJPVUdIVF9USFJFU0hPTEQpIHtcbiAgICBicmF6aWxEcm91Z2h0RWZmZWN0ID0gYEJyYXppbCBTUEktMyBhdCAke2NvbnRleHQuYnJhemlsUmFpbmZhbGxJbmRleC50b0ZpeGVkKDEpfSAoYWJvdmUgJHtCUkFaSUxfRFJPVUdIVF9USFJFU0hPTER9IHRocmVzaG9sZCkgLSBubyBkcm91Z2h0IHNpZ25hbGA7XG4gIH0gZWxzZSBpZiAoIWlzQnJhemlsRHJvdWdodFNlYXNvbiAmJiBjb250ZXh0LmJyYXppbFJhaW5mYWxsSW5kZXggPCBCUkFaSUxfRFJPVUdIVF9USFJFU0hPTEQpIHtcbiAgICBicmF6aWxEcm91Z2h0RWZmZWN0ID0gYEJyYXppbCBTUEktMyBhdCAke2NvbnRleHQuYnJhemlsUmFpbmZhbGxJbmRleC50b0ZpeGVkKDEpfSAtIGRyb3VnaHQgY29uZGl0aW9ucyBub3RlZCBidXQgb3V0c2lkZSBBdWctT2N0IHdpbmRvd2A7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIHdpblByb2JhYmlsaXR5OiBNYXRoLnJvdW5kKHdpblByb2JhYmlsaXR5ICogMTAwKSAvIDEwMCxcbiAgICByZWNvbW1lbmRlZEFjdGlvbixcbiAgICBpc0h1cnJpY2FuZUZhbHNlQWxhcm06IGZhbHNlLFxuICAgIGlzTGFOaW5hQWN0aXZlOiBjb250ZXh0LmlzTGFOaW5hLFxuICAgIGlzQnJhemlsRHJvdWdodDogZmFsc2UsXG4gICAgaW5zaWdodDoge1xuICAgICAgZnJvc3RDb25kaXRpb24sXG4gICAgICBpbnZlbnRvcnlDb25kaXRpb24sXG4gICAgICBtdWx0aXBsaWVyQXBwbGllZDogaW52ZW50b3J5TXVsdGlwbGllcixcbiAgICAgIGJhc2VXaW5SYXRlOiBiYXNlV2luUHJvYmFiaWxpdHksXG4gICAgICBsYU5pbmFFZmZlY3QsXG4gICAgICBodXJyaWNhbmVFZmZlY3QsXG4gICAgICBicmF6aWxEcm91Z2h0RWZmZWN0LFxuICAgIH0sXG4gIH07XG59XG5cbi8vIEV4cG9ydCB3aW4gcmF0ZXMgZm9yIHRoZSBTdHJhdGVneSBTdW1tYXJ5IFRhYmxlXG5leHBvcnQgY29uc3QgU1RSQVRFR1lfV0lOX1JBVEVTID0ge1xuICBsYU5pbmE6IE1BUktFVF9SVUxFUy53aW5fcmF0ZXMubGFfbmluYV9kb3VibGVfaGl0LFxuICB2b2xhdGlsaXR5OiBNQVJLRVRfUlVMRVMud2luX3JhdGVzLnZvbGF0aWxpdHlfcHJlX2Zyb3N0LFxuICByZWFsRnJvc3Q6IE1BUktFVF9SVUxFUy53aW5fcmF0ZXMucmVhbF9mcm9zdCxcbiAgaHVycmljYW5lRmFsc2VBbGFybTogTUFSS0VUX1JVTEVTLndpbl9yYXRlcy5odXJyaWNhbmVfZmFsc2VfYWxhcm0sXG4gIGJyYXppbERyb3VnaHQ6IE1BUktFVF9SVUxFUy53aW5fcmF0ZXMuYnJhemlsX2Ryb3VnaHQsXG59O1xuIl19